# Options Tests for FA Calculator

This directory contains tests for command-line options and behaviors of the FA Calculator. These tests focus on CLI functionality, argument parsing, error handling, and option combinations while using `--no-internet` to ensure fast, reproducible testing.

## ğŸ“‚ Directory Structure

```
options-tests/
â”œâ”€â”€ README.md                    # This file
â”œâ”€â”€ run_options_tests.py        # Test runner script
â””â”€â”€ test_data/                  # Auto-generated test data
    â”œâ”€â”€ vest.json              # Sample vest transactions
    â”œâ”€â”€ sell.json              # Sample sale transactions (empty)
    â””â”€â”€ public_data.json       # Cached market data for testing
```

## ğŸ§ª Test Cases

### Command-Line Options
1. **help_option** - Tests `--help` displays usage information
2. **verbose_option** - Tests `-v/--verbose` shows detailed output
3. **skip_validation_option** - Tests `-x` skips vest price validation
4. **skip_sorting_option** - Tests `-y` skips JSON file sorting
5. **data_option** - Tests `--data` uses custom data directory

### Error Handling
6. **invalid_year** - Tests handling of invalid year arguments
7. **missing_data_directory** - Tests behavior with non-existent data paths

### Option Combinations
8. **combined_options** - Tests multiple options working together (`-v -x -y`)

### Related Scripts
9. **clean_up_pii_help** - Tests `clean_up_pii.py --help`
10. **clean_up_pii_data_option** - Tests `clean_up_pii.py --data` option

## ğŸš€ Running Tests

### Run All Options Tests
```bash
cd tests/options-tests
python3 run_options_tests.py
```

### Expected Output
```
ğŸ§ª Running Options Tests for FA Calculator
Script: /path/to/fa_calculator.py
Test directory: /path/to/tests/options-tests

  Running help_option... PASSED
  Running verbose_option... PASSED
  Running skip_validation_option... PASSED
  Running skip_sorting_option... PASSED
  Running data_option... PASSED
  Running invalid_year... PASSED
  Running missing_data_directory... PASSED
  Running combined_options... PASSED
  Running clean_up_pii_help... PASSED
  Running clean_up_pii_data_option... PASSED

============================================================
ğŸ“Š OPTIONS TEST SUMMARY
============================================================
Total tests: 10
Passed: 10
Failed: 0

ğŸ‰ All tests passed!
```

## ğŸ¯ Test Focus Areas

### âœ… What These Tests Cover
- **Command-line argument parsing** and validation
- **Option behavior** (verbose, skip validation, skip sorting)
- **File handling** with custom data directories
- **Error handling** for invalid inputs
- **Option combinations** and interactions
- **Help text** and usage information
- **Script integration** (fa_calculator.py + clean_up_pii.py)

### âŒ What These Tests Don't Cover
- **Calculation accuracy** (covered by core-tests)
- **Internet connectivity** (all tests use --no-internet)
- **Real market data** (uses cached test data)
- **Performance benchmarks** (focused on functionality)

## ğŸ“Š Test Data Characteristics

### Sample Data Used
- **Stock Symbol**: TEST (dummy stock)
- **Vest Date**: 2023-01-15 (50 shares)
- **Price Range**: $100-$110 throughout 2023
- **Exchange Rates**: 82.50-83.25 INR/USD
- **No Sales**: Empty sell.json for simplicity

### Data Generation
Test data is automatically generated by the test runner:
- Minimal but complete data structure
- All required fields present
- Realistic but simple values
- Cached data for offline testing

## ğŸ”§ Technical Details

### Test Runner Features
- **Timeout Protection**: 30-second timeout per test
- **Error Capture**: Captures both stdout and stderr
- **Cleanup**: Automatically removes generated files
- **Detailed Reporting**: Shows specific failure reasons
- **Exit Codes**: Returns appropriate exit codes for CI/CD

### Test Isolation
- Each test uses fresh data
- Temporary directories for file operations
- No cross-test dependencies
- Deterministic results

## ğŸš€ Integration

These tests complement the core-tests:
- **Core Tests**: Validate calculation correctness and accuracy
- **Options Tests**: Validate CLI behavior and error handling
- **Combined**: Ensure the complete system works reliably

Run both test suites for comprehensive validation:
```bash
# Run core functionality tests
cd tests/core-tests && python3 run_core_tests.py

# Run options and CLI tests  
cd tests/options-tests && python3 run_options_tests.py
```

## ğŸ“ˆ Future Enhancements

Potential additions to options testing:
- Performance benchmarking tests
- Memory usage validation
- Configuration file testing
- Integration with external tools
- Stress testing with large datasets
